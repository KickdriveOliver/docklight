DL_SCRIPTVERSION
1
46988

' SideChannel_Example.pts
' DL.OpenSideChannel / DL.CloseSideChannel
' (use DL.DirectSend to send data) 

DL.OpenProject "SideChannel_Example.ptp"

DL.ClearCommWindows 
DL.AddComment
DL.AddComment "Check defaults (queue ID = 3, use channel tag <Channel3>)"
DL.SetChannelSettings "LOCALHOST:10001"
DL.StartCommunication
DL.OpenSideChannel "SERVER:10001"
DL.ResetReceiveCounter
DL.SendSequence "", "Test", "A"
DL.WaitForSequence "Channel3", 1, 500
DL.AddComment
DL.AddComment "Send data on Channel3"
DL.DirectSend 3, "Hello World!"
DL.WaitForSequence "HelloWorld", 1, 500
DL.AddComment "Stop the Channel3. This should cause a TCP client connection error.."
DL.CloseSideChannel
DL.Pause 4000
' close all channels
DL.StopCommunication

' All side channel status needs to be zero now
DL.AddComment
DL.AddComment "Channel status before opening"
For i = 3 to 10
   DL.AddComment "GetChannelStatus(" & i & ") = " & DL.GetChannelStatus(i)
Next

' "OpenSideChannel" always starts the main communication channel alongside. 
' So for this test we us a dummy UDP loopback than never fails.
DL.SetChannelSettings "UDP:LOCALHOST:10002"
DL.AddComment
DL.AddComment 
DL.AddComment "Connect 4 TCP Server side channels with 4 TCP Client side channels..."
For i = 1 to 4
    DL.OpenSideChannel "SERVER:" & CStr(10010 + i), i + 2
    DL.OpenSideChannel "LOCALHOST:"& CStr(10010 + i), i + 6
Next

' again, let me see the channel status
DL.AddComment "Channel status after opening"
For i = 3 to 10
   DL.AddComment "GetChannelStatus(" & i & ") = " & DL.GetChannelStatus(i)
Next

DL.Pause 2000
For i = 3 to 10
    DL.DirectSend i, "Sending from Side Channel " & CStr(i)
    DL.DirectSend i, "Test"
    DL.Pause 100
Next
DL.Pause 500
DL.AddComment "Closing client/server connections..."
For i = 1 to 4
    ' close client first, then server
    DL.CloseSideChannel i + 6
    DL.OpenSideChannel i + 2
Next

DL.AddComment
DL.AddComment "Try a serial port with binary data"
DL.OpenSideChannel "COM1:9600,N,8,1", 3, "MyCOMSideChannel"
DL.DirectSend 3, "FA", "H"
DL.WaitForSequence "BinaryTest", 1, 500

DL.AddComment
DL.AddComment "Don't use tags. Now RX data cannot distringuished from other data"
DL.OpenSideChannel "COM1:9600,N,8,1", 3, ""
DL.DirectSend 3, "No RX data tags", "A"
DL.Pause 500

DL.AddComment
DL.AddComment "Serial port for sending only"
DL.OpenSideChannel "COM1:9600,N,8,1", 3, "norx"
DL.AddComment "Text data"
DL.DirectSend 3, "Sending only", "A"
DL.AddComment "Binary data"
DL.DirectSend 3, "01 02 03 04 FF FA 00", "H"
DL.Pause 1000
DL.CloseSideChannel
DL.Pause 500


